<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Apólices</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/pt-br.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 40;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        .modal.open, .modal-backdrop.open {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar absolute md:relative bg-gray-800 text-white w-64 min-h-screen p-4 z-20">
        <div class="flex items-center mb-8">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400 h-8 w-8"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
            <h1 class="text-xl font-bold ml-2">Gestor Apólice</h1>
        </div>
        <nav>
            <a href="#" id="nav-dashboard" class="nav-item bg-gray-700 block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700">Dashboard</a>
            <a href="#" id="nav-clients" class="nav-item block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700">Clientes</a>
            <a href="#" id="nav-policies" class="nav-item block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700">Apólices</a>
        </nav>
    </aside>

    <!-- Main content -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="bg-white shadow-md p-4 flex justify-between items-center">
            <button id="menu-button" class="md:hidden text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
            </button>
            <h2 id="page-title" class="text-xl font-semibold text-gray-700">Dashboard</h2>
            <div><!-- future user profile icon --></div>
        </header>

        <main id="main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
            <!-- Content will be injected here -->
        </main>
    </div>
</div>

<!-- Modal Backdrop -->
<div id="modal-backdrop" class="modal-backdrop"></div>

<!-- Client Modal -->
<div id="client-modal" class="modal bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
    <div class="border-b px-6 py-4">
        <h3 id="client-modal-title" class="text-lg font-semibold">Adicionar Novo Cliente</h3>
    </div>
    <div class="p-6">
        <form id="client-form">
            <input type="hidden" id="client-id">
            <div class="mb-4">
                <label for="client-name" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo</label>
                <input type="text" id="client-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
            </div>
            <div class="mb-4">
                <label for="client-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="client-email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
            </div>
            <div class="mb-4">
                <label for="client-phone" class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                <input type="tel" id="client-phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            <div class="mb-4">
                <label for="client-cpf" class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                <input type="text" id="client-cpf" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
        </form>
    </div>
    <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3 rounded-b-lg">
        <button id="cancel-client-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancelar</button>
        <button id="save-client-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Salvar</button>
    </div>
</div>

<!-- Policy Modal -->
<div id="policy-modal" class="modal bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
    <div class="border-b px-6 py-4">
        <h3 id="policy-modal-title" class="text-lg font-semibold">Adicionar Nova Apólice</h3>
    </div>
    <div class="p-6">
        <form id="policy-form">
            <input type="hidden" id="policy-id">
            <div class="mb-4">
                <label for="policy-client" class="block text-sm font-medium text-gray-700 mb-1">Cliente</label>
                <select id="policy-client" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required></select>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="mb-4">
                    <label for="policy-number" class="block text-sm font-medium text-gray-700 mb-1">Nº da Apólice</label>
                    <input type="text" id="policy-number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="policy-insurer" class="block text-sm font-medium text-gray-700 mb-1">Seguradora</label>
                    <input type="text" id="policy-insurer" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="mb-4">
                    <label for="policy-type" class="block text-sm font-medium text-gray-700 mb-1">Ramo do Seguro</label>
                    <select id="policy-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option>Automóvel</option>
                        <option>Residencial</option>
                        <option>Vida</option>
                        <option>Saúde</option>
                        <option>Empresarial</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="policy-premium" class="block text-sm font-medium text-gray-700 mb-1">Valor do Prêmio (R$)</label>
                    <input type="number" step="0.01" id="policy-premium" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
            </div>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="mb-4">
                    <label for="policy-start-date" class="block text-sm font-medium text-gray-700 mb-1">Início da Vigência</label>
                    <input type="date" id="policy-start-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="policy-end-date" class="block text-sm font-medium text-gray-700 mb-1">Fim da Vigência</label>
                    <input type="date" id="policy-end-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
            </div>
        </form>
    </div>
    <div class="bg-gray-50 px-6 py-4 flex justify-end space-x-3 rounded-b-lg">
        <button id="cancel-policy-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancelar</button>
        <button id="save-policy-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Salvar</button>
    </div>
</div>


<script>
    dayjs.extend(dayjs_plugin_relativeTime);
    dayjs.locale('pt-br');

    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        let clients = [
            { id: 1, name: 'Ana Silva', email: 'ana.silva@example.com', phone: '(11) 98765-4321', cpf: '123.456.789-00' },
            { id: 2, name: 'Bruno Costa', email: 'bruno.costa@example.com', phone: '(21) 91234-5678', cpf: '111.222.333-44' },
            { id: 3, name: 'Carla Dias', email: 'carla.dias@example.com', phone: '(31) 95555-1234', cpf: '987.654.321-99' }
        ];

        let policies = [
            { id: 1, clientId: 1, number: 'AP-12345', insurer: 'Porto Seguro', type: 'Automóvel', premium: 2500.00, startDate: '2024-10-01', endDate: '2025-10-01' },
            { id: 2, clientId: 2, number: 'AP-67890', insurer: 'Allianz', type: 'Residencial', premium: 800.00, startDate: '2024-05-20', endDate: '2025-05-20' },
            { id: 3, clientId: 1, number: 'AP-11223', insurer: 'SulAmérica', type: 'Saúde', premium: 4800.00, startDate: '2025-01-15', endDate: '2026-01-15' },
            { id: 4, clientId: 3, number: 'AP-44556', insurer: 'Tokio Marine', type: 'Automóvel', premium: 3100.00, startDate: '2024-09-15', endDate: '2025-09-15' }
        ];

        // --- STATE ---
        let currentPage = 'dashboard';
        let currentClientId = null;
        let currentPolicyId = null;

        // --- ELEMENTS ---
        const mainContent = document.getElementById('main-content');
        const pageTitle = document.getElementById('page-title');
        const navItems = document.querySelectorAll('.nav-item');
        const menuButton = document.getElementById('menu-button');
        const sidebar = document.getElementById('sidebar');

        // --- UTILS ---
        const getPolicyStatus = (endDate) => {
            const today = dayjs();
            const end = dayjs(endDate);
            if (end.isBefore(today)) return { text: 'Vencida', color: 'red' };
            if (end.diff(today, 'day') <= 30) return { text: 'Vence em Breve', color: 'yellow' };
            return { text: 'Ativa', color: 'green' };
        };

        const formatCurrency = (value) => {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        };
        
        const formatDate = (dateString) => {
            return dayjs(dateString).format('DD/MM/YYYY');
        }

        // --- MODAL HANDLING ---
        const clientModal = document.getElementById('client-modal');
        const policyModal = document.getElementById('policy-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const clientForm = document.getElementById('client-form');
        const policyForm = document.getElementById('policy-form');

        const openModal = (modal) => {
            modal.classList.add('open');
            modalBackdrop.classList.add('open');
        };

        const closeModal = (modal) => {
            modal.classList.remove('open');
            modalBackdrop.classList.remove('open');
            clientForm.reset();
            policyForm.reset();
            currentClientId = null;
            currentPolicyId = null;
        };

        modalBackdrop.addEventListener('click', () => {
            closeModal(clientModal);
            closeModal(policyModal);
        });

        document.getElementById('cancel-client-btn').addEventListener('click', () => closeModal(clientModal));
        document.getElementById('cancel-policy-btn').addEventListener('click', () => closeModal(policyModal));

        // --- RENDER FUNCTIONS ---
        const renderDashboard = () => {
            pageTitle.textContent = 'Dashboard';
            
            const activePolicies = policies.filter(p => getPolicyStatus(p.endDate).text !== 'Vencida');
            const expiringSoonPolicies = policies.filter(p => getPolicyStatus(p.endDate).text === 'Vence em Breve').sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
            const totalPremium = policies.reduce((sum, p) => sum + p.premium, 0);

            mainContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500 h-6 w-6"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Total de Clientes</p>
                            <p class="text-2xl font-bold">${clients.length}</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-green-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500 h-6 w-6"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Apólices Ativas</p>
                            <p class="text-2xl font-bold">${activePolicies.length}</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-yellow-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500 h-6 w-6"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">A Vencer (30d)</p>
                            <p class="text-2xl font-bold">${expiringSoonPolicies.length}</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center">
                        <div class="bg-indigo-100 p-3 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500 h-6 w-6"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Prêmio Anualizado</p>
                            <p class="text-2xl font-bold">${formatCurrency(totalPremium)}</p>
                        </div>
                    </div>
                </div>

                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold mb-4">Apólices com Vencimento Próximo</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b">
                                    <th class="py-2 px-4">Cliente</th>
                                    <th class="py-2 px-4">Nº Apólice</th>
                                    <th class="py-2 px-4">Seguradora</th>
                                    <th class="py-2 px-4">Fim da Vigência</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${expiringSoonPolicies.length > 0 ? expiringSoonPolicies.map(p => {
                                    const client = clients.find(c => c.id === p.clientId);
                                    return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">${client?.name || 'N/A'}</td>
                                        <td class="py-3 px-4">${p.number}</td>
                                        <td class="py-3 px-4">${p.insurer}</td>
                                        <td class="py-3 px-4">${formatDate(p.endDate)} (${dayjs(p.endDate).fromNow()})</td>
                                    </tr>
                                    `
                                }).join('') : `<tr><td colspan="4" class="text-center py-4 text-gray-500">Nenhuma apólice vencendo nos próximos 30 dias.</td></tr>`}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        };
        
        const renderClients = () => {
            pageTitle.textContent = 'Clientes';
            mainContent.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Gerenciar Clientes</h3>
                        <button id="add-client-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                            Adicionar Cliente
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b">
                                    <th class="py-2 px-4">Nome</th>
                                    <th class="py-2 px-4 hidden md:table-cell">Email</th>
                                    <th class="py-2 px-4 hidden md:table-cell">Telefone</th>
                                    <th class="py-2 px-4">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${clients.map(client => `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4">${client.name}</td>
                                        <td class="py-3 px-4 hidden md:table-cell">${client.email}</td>
                                        <td class="py-3 px-4 hidden md:table-cell">${client.phone}</td>
                                        <td class="py-3 px-4">
                                            <button data-id="${client.id}" class="edit-client-btn text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                            <button data-id="${client.id}" class="delete-client-btn text-red-600 hover:text-red-900">Excluir</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            document.getElementById('add-client-btn').addEventListener('click', handleAddClient);
            document.querySelectorAll('.edit-client-btn').forEach(btn => btn.addEventListener('click', handleEditClient));
            document.querySelectorAll('.delete-client-btn').forEach(btn => btn.addEventListener('click', handleDeleteClient));
        };

        const renderPolicies = () => {
            pageTitle.textContent = 'Apólices';
            mainContent.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Gerenciar Apólices</h3>
                        <button id="add-policy-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
                            Adicionar Apólice
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                             <thead>
                                <tr class="border-b">
                                    <th class="py-2 px-4">Nº Apólice</th>
                                    <th class="py-2 px-4">Cliente</th>
                                    <th class="py-2 px-4 hidden md:table-cell">Seguradora</th>
                                    <th class="py-2 px-4 hidden lg:table-cell">Ramo</th>
                                    <th class="py-2 px-4">Fim Vigência</th>
                                    <th class="py-2 px-4">Status</th>
                                    <th class="py-2 px-4">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${policies.map(policy => {
                                    const client = clients.find(c => c.id === policy.clientId);
                                    const status = getPolicyStatus(policy.endDate);
                                    const statusColors = {
                                        'red': 'bg-red-100 text-red-800',
                                        'yellow': 'bg-yellow-100 text-yellow-800',
                                        'green': 'bg-green-100 text-green-800'
                                    };
                                    return `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="py-3 px-4 font-medium">${policy.number}</td>
                                        <td class="py-3 px-4">${client?.name || 'N/A'}</td>
                                        <td class="py-3 px-4 hidden md:table-cell">${policy.insurer}</td>
                                        <td class="py-3 px-4 hidden lg:table-cell">${policy.type}</td>
                                        <td class="py-3 px-4">${formatDate(policy.endDate)}</td>
                                        <td class="py-3 px-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColors[status.color]}">${status.text}</span></td>
                                        <td class="py-3 px-4">
                                            <button data-id="${policy.id}" class="edit-policy-btn text-indigo-600 hover:text-indigo-900 mr-3">Editar</button>
                                            <button data-id="${policy.id}" class="delete-policy-btn text-red-600 hover:text-red-900">Excluir</button>
                                        </td>
                                    </tr>
                                `}).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            document.getElementById('add-policy-btn').addEventListener('click', handleAddPolicy);
            document.querySelectorAll('.edit-policy-btn').forEach(btn => btn.addEventListener('click', handleEditPolicy));
            document.querySelectorAll('.delete-policy-btn').forEach(btn => btn.addEventListener('click', handleDeletePolicy));
        };
        
        // --- EVENT HANDLERS & LOGIC ---

        // Client handlers
        const handleAddClient = () => {
            document.getElementById('client-modal-title').textContent = 'Adicionar Novo Cliente';
            clientForm.reset();
            currentClientId = null;
            openModal(clientModal);
        };

        const handleEditClient = (e) => {
            currentClientId = parseInt(e.target.dataset.id);
            const client = clients.find(c => c.id === currentClientId);
            if (client) {
                document.getElementById('client-modal-title').textContent = 'Editar Cliente';
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-email').value = client.email;
                document.getElementById('client-phone').value = client.phone;
                document.getElementById('client-cpf').value = client.cpf;
                openModal(clientModal);
            }
        };

        const handleDeleteClient = (e) => {
            const clientId = parseInt(e.target.dataset.id);
            if (confirm('Tem certeza que deseja excluir este cliente? Todas as apólices associadas também serão removidas.')) {
                clients = clients.filter(c => c.id !== clientId);
                policies = policies.filter(p => p.clientId !== clientId);
                renderClients();
            }
        };

        document.getElementById('save-client-btn').addEventListener('click', () => {
            const name = document.getElementById('client-name').value.trim();
            const email = document.getElementById('client-email').value.trim();
            
            if(!name || !email) {
                alert('Nome e Email são obrigatórios.');
                return;
            }

            const clientData = {
                name,
                email,
                phone: document.getElementById('client-phone').value,
                cpf: document.getElementById('client-cpf').value,
            };

            if (currentClientId) {
                const index = clients.findIndex(c => c.id === currentClientId);
                clients[index] = { ...clients[index], ...clientData };
            } else {
                clientData.id = clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1;
                clients.push(clientData);
            }
            closeModal(clientModal);
            renderClients();
        });


        // Policy handlers
        const populateClientDropdown = (selectedClientId = null) => {
            const select = document.getElementById('policy-client');
            select.innerHTML = '<option value="">-- Selecione um cliente --</option>';
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                if(client.id === selectedClientId) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        };

        const handleAddPolicy = () => {
            document.getElementById('policy-modal-title').textContent = 'Adicionar Nova Apólice';
            policyForm.reset();
            currentPolicyId = null;
            populateClientDropdown();
            openModal(policyModal);
        };

        const handleEditPolicy = (e) => {
            currentPolicyId = parseInt(e.target.dataset.id);
            const policy = policies.find(p => p.id === currentPolicyId);
            if (policy) {
                document.getElementById('policy-modal-title').textContent = 'Editar Apólice';
                populateClientDropdown(policy.clientId);
                document.getElementById('policy-id').value = policy.id;
                document.getElementById('policy-number').value = policy.number;
                document.getElementById('policy-insurer').value = policy.insurer;
                document.getElementById('policy-type').value = policy.type;
                document.getElementById('policy-premium').value = policy.premium;
                document.getElementById('policy-start-date').value = policy.startDate;
                document.getElementById('policy-end-date').value = policy.endDate;
                openModal(policyModal);
            }
        };

        const handleDeletePolicy = (e) => {
            const policyId = parseInt(e.target.dataset.id);
            if (confirm('Tem certeza que deseja excluir esta apólice?')) {
                policies = policies.filter(p => p.id !== policyId);
                renderPolicies();
            }
        };

        document.getElementById('save-policy-btn').addEventListener('click', () => {
            const clientId = parseInt(document.getElementById('policy-client').value);
            const number = document.getElementById('policy-number').value.trim();
            const insurer = document.getElementById('policy-insurer').value.trim();
            const premium = parseFloat(document.getElementById('policy-premium').value);

            if(!clientId || !number || !insurer || isNaN(premium)) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            const policyData = {
                clientId,
                number,
                insurer,
                premium,
                type: document.getElementById('policy-type').value,
                startDate: document.getElementById('policy-start-date').value,
                endDate: document.getElementById('policy-end-date').value,
            };

            if (currentPolicyId) {
                const index = policies.findIndex(p => p.id === currentPolicyId);
                policies[index] = { ...policies[index], ...policyData };
            } else {
                policyData.id = policies.length > 0 ? Math.max(...policies.map(p => p.id)) + 1 : 1;
                policies.push(policyData);
            }
            closeModal(policyModal);
            renderPolicies();
        });


        // --- NAVIGATION ---
        const navigate = (page) => {
            currentPage = page;
            navItems.forEach(item => {
                item.classList.remove('bg-gray-700');
                if (item.id === `nav-${page}`) {
                    item.classList.add('bg-gray-700');
                }
            });

            switch (page) {
                case 'clients':
                    renderClients();
                    break;
                case 'policies':
                    renderPolicies();
                    break;
                case 'dashboard':
                default:
                    renderDashboard();
                    break;
            }
        };

        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.target.id.split('-')[1];
                navigate(page);
                if (window.innerWidth < 768) {
                    sidebar.classList.remove('open');
                }
            });
        });

        menuButton.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        // Initial render
        navigate('dashboard');
    });
</script>

</body>
</html>
